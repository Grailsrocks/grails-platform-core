<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5.1 Sending Events 1.0.RC2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript" src="../css/shCore.js"></script>
    <script type="text/javascript" src="../css/shBrushXml.js"></script>
    <script type="text/javascript" src="../css/shBrushGroovy.js"></script>
    <link type="text/css" rel="stylesheet" href="../css/shCoreMidnight.css"/>
    <script type="text/javascript">
        SyntaxHighlighter.config.stripBrs = true;
        SyntaxHighlighter.defaults['smart-tabs'] = true;
        SyntaxHighlighter.all();
        function addJsClass() {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/overview.html"><strong>1</strong><span>Overview</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/configuration.html"><strong>3</strong><span>Configuration API</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>4</strong><span>Security API</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/events.html"><strong>5</strong><span>Events Bus API</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/nav.html"><strong>6</strong><span>Navigation API</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/uiextension.html"><strong>7</strong><span>UI Extensions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/injection.html"><strong>8</strong><span>Injection API</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/convention.html"><strong>9</strong><span>Convention API</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>APIs and Tags for advanced Plugin integration</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                <div class="toc-item prev-left"><a href="../../guide/security.html">&lt;&lt; <strong>4</strong><span>Security API</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                <div class="toc-item next-right"><a href="../../guide/nav.html"><strong>6</strong><span>Navigation API</span> >></a></div>
                


                <div class="project">
                    <h1>5.1 Sending Events - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Marc Palmer (marc@grailsrocks.com), Stéphane Maldini (smaldini@vmware.com)</p>

                    <p><strong>Version:</strong> 1.0.RC2</p>

                    
                </div>

                

                

<h2 id="sending">5.1 Sending Events</h2>
Sending an event is simple. You only need to remind 1 method name and 2 different signatures:
<ul class="star">
<li><strong class="bold">event</strong>(topic, &#91;data, params, callbackClosure&#93;)</li>
<li><strong class="bold">event</strong>(Map args, &#91;callbackClosure&#93;)</li>
</ul><p class="paragraph"/>We recommend using the former signature if you don't have any params, otherwise the latter is more elegant in that case.<p class="paragraph"/>Let's see what the key arguments are doing:
<ul class="star">
<li>Topic argument is a <strong class="bold">String</strong> which represents channel subscribed by listeners.</li>
<li> <em class="italic">optional</em>  Data argument is an <strong class="bold">Object</strong> - <em class="italic">preferrably Serializable for IO facilities</em> - which represents the subject of your event such as a domain class.</li>
<li> <em class="italic">optional</em>  Params argument is a <strong class="bold">Map</strong> which represents sending behaviors including <strong class="bold">namespace</strong>.</li>
<li> <em class="italic">optional</em>  callbackClosure is a <strong class="bold">Closure</strong> triggered after an event completion.</li>
<li>The map notation allows you to reuse the same arguments than params plus <strong class="bold">topic</strong> for topic, <strong class="bold">data</strong> for data and <strong class="bold">for</strong> (shortcut for 'namespace'). If you specify <strong class="bold">params</strong>, it will use it for the <strong class="bold">params</strong> argument otherwise the first level map is used as <strong class="bold">params</strong>.</li>
</ul><p class="paragraph"/>There are several <strong class="bold">params</strong> arguments :
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Key</strong></th><th><strong class="bold">Type</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>fork</td><td><code>Boolean</code></td><td><code>false</code></td><td>Force the event to reuse the caller thread, therefore executing the method synchronously and propagating any errors.</td></tr><tr class="table-even"><td>namespace / for</td><td><code>String</code></td><td><code>'app'</code></td><td>Target a dedicated topic namespace. To avoid overlapping topic names, the events bus supports a scoping concept called namespace. E.g. 'gorm' is used by gorm events and 'browser' is used for Javascript listeners in <strong class="bold">events-push</strong> plugin.</td></tr><tr class="table-odd"><td>onReply</td><td><code>Closure&#123;EventReply reply&#125;</code></td><td>&#160;</td><td>Same behavior than  <em class="italic">callbackClosure</em>  argument, overrides it if both are defined.</td></tr><tr class="table-even"><td>onError</td><td><code>Closure&#123;List&#60;Exception&#62; errors&#125;</code></td><td>&#160;</td><td>If exceptions has been raised by listeners, this callback will be triggered. If undefined, exceptions will be propagated on EventReply.getValue(s).</td></tr><tr class="table-odd"><td>gormSession</td><td><code>Boolean</code></td><td><code>true</code></td><td>Opens a GORM session for the new thread which carries event execution.</td></tr><tr class="table-even"><td>timeout</td><td><code>Long</code></td><td>&#160;</td><td>Define a maximum time in millisecond for the event execution.</td></tr><tr class="table-odd"><td>headers</td><td><code>Map&#60;String, Serializable&#62;</code></td><td>&#160;</td><td>Additional headers for the event message enveloppe.</td></tr></table><p class="paragraph"/>The event method returns <strong class="bold">EventReply</strong> which implements Future&#60;Object&#62; and provides usefuls methods :
<ul class="star">
<li><strong class="bold">List&#60;Object&#62; getValues()</strong> : Returns as many values as listeners has replied.</li>
<li><strong class="bold">Object getValue()</strong> : First element of getValues().</li>
<li><strong class="bold">int size()</strong> : Invoked listeners count.</li>
<li><strong class="bold">List&#60;Throwable&#62; getErrors()</strong> : Available errors.</li>
<li><strong class="bold">boolean hasErrors()</strong> : Scans for any errors.</li>
<li><strong class="bold">EventReply waitFor()</strong> : blocks current thread and return this reply.</li>
<li><strong class="bold">EventReply waitFor(long time)</strong> : blocks current thread for T milliseconds and returns this reply.</li>
</ul><p class="paragraph"/><h3>Events workflow</h3>
Events can be sent from domains, services and controllers artefacts by using  <em class="italic">EventReply event(String topic, Object data)</em> .
Platform-core Events bus provides a non-blocking way to send events by default, however you can <strong class="bold">block on several methods</strong> from <strong class="bold">EventReply</strong> :
<ul class="star">
<li><strong class="bold">size</strong></li>
<li><strong class="bold">waitFor</strong></li>
<li><strong class="bold">get</strong></li>
<li><strong class="bold">getValues</strong></li>
<li><strong class="bold">getValue</strong></li>
</ul><p class="paragraph"/>Therefore you have the control on the execution flow if you want. Just keep in mind it does not block for processing right after event() call, which seems to be a
sensible default for the bus. Eventual <strong class="bold">Exceptions</strong> will be raised after using one of the mentioned blocking methods  except if <strong class="bold">onError</strong> parameter is used.<p class="paragraph"/><pre class="brush: groovy;">&#10;class SomeController&#123;&#10;&#10;   def logout()&#123;&#10;      def reply = event("logout", session.user)&#10;      //doesn't wait for event execution&#10;      &#10;      render reply.value  //wait and display value&#10;      &#10;      event(topic:"afterLogout").waitFor()&#10;      &#10;      //Only triggered when "afterLogout" finished&#10;      def errorHandler = &#123;errs &#45;&#62; &#125;&#10;      //Use a dedicated error handler&#10;      event(topic:"afterAfterLogout", onError:errs)&#10;   &#125;&#10;&#125;&#10;</pre><p class="paragraph"/>
<h3>Non forked events</h3>
If you want to reuse the current thread and force synchronous processing, use the fork param. Be aware that each exception will be directly propagated to caller even without using blocking methods except
if <strong class="bold">onError</strong> parameter is used.<p class="paragraph"/><pre class="brush: groovy;">&#10;class SomeController&#123;&#10;&#10;   def logout()&#123;&#10;      def reply = event('logout', session.user, &#91;fork:false&#93;)&#10;      //block for processing&#10;&#10;      //no need to wait for reply since it has been populated on event call.&#10;      render reply.value&#10;   &#125;&#10;&#125;&#10;</pre><p class="paragraph"/><h3>Assigning a namespace</h3>
All listeners get a property called namespace which prevents topic naming collisions and undesired events. By default, they are all assigned to <strong class="bold">app</strong>.
 This is the same default used when you send an event, but what if you want to reach others namespaced listeners, like 'browser' ones if you use <strong class="bold">events-push</strong> plugin ? Simply use <strong class="bold">namespace</strong> argument or use <strong class="bold">for</strong> if you stick with Map notation.<p class="paragraph"/><pre class="brush: groovy;">&#10; class SomeController&#123;&#10;&#10;    def logout()&#123;&#10;        //we use the Map form, the namespace argument is identified by the 'for' key&#10;       event for:'browser', topic:'logout', data:session.user&#10;    &#125;&#10; &#125;&#10;</pre><p class="paragraph"/><blockquote class="warning">
It's mandatory to declare namespace when using events bus from a plugin in order to avoid any conflicts.
</blockquote><p class="paragraph"/><h3>Wildcard support</h3>
It's possible to call multiple topics/namespaces in a single shot using <strong class="bold">wildcard as the last character</strong>.<p class="paragraph"/><pre class="brush: groovy;">&#10;class SomeController&#123;&#10;&#10;    def logout()&#123;&#10;        /&#42;&#10;          We send to every listeners starting with "chat&#45;"&#10;          on every namespaces starting with "role&#45;"&#10;        &#42;/&#10;        event for:'role&#45;&#42;', topic:'chat&#45;&#42;', data:session.user&#10;&#10;        //Here we can trigger every listeners in the default namespace 'app'&#10;        event '&#42;'&#10;    &#125;&#10;&#125;&#10;</pre><p class="paragraph"/><blockquote class="note">
This feature will probably evolve to a smarter implementation behaving like UrlMappings and authorizing substring captures
</blockquote><p class="paragraph"/>



                <div style="clear:both;margin-top:15px;"></div>
                
                <div class="toc-item prev-left"><a href="../../guide/security.html">&lt;&lt; <strong>4</strong><span>Security API</span></a></div>
                
                <div class="toc-item next-right"><a href="../../guide/nav.html"><strong>6</strong><span>Navigation API</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Beans</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Beans/grailsConventions.html">grailsConventions</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Beans/grailsEvents.html">grailsEvents</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Beans/grailsInjection.html">grailsInjection</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Beans/grailsNavigation.html">grailsNavigation</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Beans/grailsPluginConfiguration.html">grailsPluginConfiguration</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Beans/grailsSecurity.html">grailsSecurity</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Beans/grailsUiExtensions.html">grailsUiExtensions</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Events Methods</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Events%20Methods/countListeners.html">countListeners</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Events%20Methods/event.html">event</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Events%20Methods/on.html">on</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Events%20Methods/removeListeners.html">removeListeners</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Events%20Methods/waitFor.html">waitFor</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Global Properties</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Global%20Properties/pluginConfig.html">pluginConfig</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Navigation Tags</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Navigation%20Tags/menu.html">menu</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Navigation%20Tags/primary.html">primary</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Navigation%20Tags/secondary.html">secondary</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Navigation%20Tags/set.html">set</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Navigation%20Tags/title.html">title</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Plugin Conventions</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Plugin%20Conventions/doWithConfig.html">doWithConfig</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Plugin%20Conventions/doWithConfigOptions.html">doWithConfigOptions</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Scripts/update-header.html">update-header</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Security Methods</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Security%20Methods/userHasAllRoles.html">userHasAllRoles</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Methods/userHasAnyRole.html">userHasAnyRole</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Methods/userIsAllowed.html">userIsAllowed</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Methods/withUser.html">withUser</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Security Properties</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Security%20Properties/securityIdentity.html">securityIdentity</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Properties/securityInfo.html">securityInfo</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Security Tags</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/createLoginLink.html">createLoginLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/createLogoutLink.html">createLogoutLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/createSignupLink.html">createSignupLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/identity.html">identity</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/ifLoggedIn.html">ifLoggedIn</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/ifNotLoggedIn.html">ifNotLoggedIn</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/ifNotPermitted.html">ifNotPermitted</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/ifPermitted.html">ifPermitted</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/info.html">info</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/loginButton.html">loginButton</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/logoutButton.html">logoutButton</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Security%20Tags/signupButton.html">signupButton</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags System</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Tags%20System/config.html">config</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Tags%20System/requiresBean.html">requiresBean</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Ui Extension Methods</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Methods/displayFlashMessage.html">displayFlashMessage</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Methods/displayMessage.html">displayMessage</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Ui Extension Properties</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Properties/pluginFlash.html">pluginFlash</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Properties/pluginRequestAttributes.html">pluginRequestAttributes</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Properties/pluginSession.html">pluginSession</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Ui Extension Tags</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/attrIfSet.html">attrIfSet</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/button.html">button</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/callTag.html">callTag</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/displayMessage.html">displayMessage</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/dummyText.html">dummyText</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/joinClasses.html">joinClasses</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/label.html">label</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/organization.html">organization</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/siteLink.html">siteLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/siteName.html">siteName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/siteURL.html">siteURL</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/smartLink.html">smartLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/text.html">text</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/textScope.html">textScope</a>
                        </div>
                        
                        <div class="menu-item"><a href="../../ref/Ui%20Extension%20Tags/year.html">year</a>
                        </div>
                        
                    </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Utility Classes</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../../ref/Utility%20Classes/TagLibUtils.html">TagLibUtils</a>
                        </div>
                        
                    </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    &copy; 2012 Marc Palmer & Stéphane Maldini
    Please contact the authors with any corrections or suggestions
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>